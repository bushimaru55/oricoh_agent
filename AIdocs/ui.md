# 画面仕様書

## 概要

oricoh_agentのNext.jsフロントエンド画面仕様書です。すべての画面はマルチテナント対応で、JWT認証が必要です。

---

## 共通仕様

### レイアウト
- ヘッダー: ロゴ、ナビゲーション、ユーザー情報
- サイドバー: メニュー（ログイン画面を除く）
- メインコンテンツ: 各画面のコンテンツ
- フッター: コピーライト等

### デザインシステム
- フレームワーク: Tailwind CSS
- カラーパレット: 企業向けの落ち着いた色調
- フォント: システムフォント（可読性重視）
- レスポンシブ: モバイル・タブレット・デスクトップ対応

### 認証状態管理
- JWTトークンをローカルストレージに保存
- トークン有効期限切れ時は自動ログアウト
- 未認証ユーザーは`/login`にリダイレクト

---

## 1. ログイン画面（/login）

### 画面概要
ユーザーがログインする画面です。

### URL
`/login`

### 認証
不要（未認証ユーザー向け）

### レイアウト
- 中央配置のログインフォーム
- 背景はシンプルなグラデーション

### UI要素

#### ログインフォーム
- **ユーザー名入力欄**
  - タイプ: テキスト入力
  - プレースホルダー: "ユーザー名またはメールアドレス"
  - バリデーション: 必須、最小3文字

- **パスワード入力欄**
  - タイプ: パスワード入力
  - プレースホルダー: "パスワード"
  - バリデーション: 必須、最小8文字
  - 表示/非表示切り替えボタン

- **ログインボタン**
  - タイプ: プライマリボタン
  - ラベル: "ログイン"
  - ローディング状態表示

- **エラーメッセージ表示**
  - 認証失敗時に表示
  - 赤色のアラート形式

### 動作フロー
1. ユーザーがユーザー名・パスワードを入力
2. 「ログイン」ボタンをクリック
3. `/api/auth/login`にPOSTリクエスト
4. 成功時: JWTを保存し、`/chat`にリダイレクト
5. 失敗時: エラーメッセージを表示

### レスポンシブ対応
- モバイル: フォーム幅100%、パディング調整
- タブレット以上: フォーム幅400px、中央配置

---

## 2. チャット画面（/chat）

### 画面概要
RAG検索によるAIチャットを行うメイン画面です。

### URL
`/chat`

### 認証
必須

### レイアウト
- 左側: チャット履歴一覧（サイドバー）
- 右側: チャットエリア（メイン）

### UI要素

#### チャット履歴サイドバー
- **新規チャットボタン**
  - 新しいチャットを開始
  - アイコン: プラス記号

- **履歴リスト**
  - 各履歴は質問の最初の50文字を表示
  - クリックで履歴を読み込み
  - 日時表示
  - スクロール可能

#### チャットエリア
- **エージェント選択ドロップダウン**
  - チャットエリア上部に表示
  - 組織内のアクティブなエージェント一覧を表示
  - エージェント名、説明、文書数を表示
  - 選択したエージェントがチャットに使用される
  - 「エージェントを管理」リンク（`/agents`へ遷移）

- **メッセージ表示エリア**
  - ユーザーメッセージ: 右寄せ、青色背景
  - AIメッセージ: 左寄せ、グレー背景
  - マークダウン対応
  - コードブロックのシンタックスハイライト
  - エージェント名を表示（各メッセージに）

- **Citations表示**
  - AI回答の下に表示
  - 参照元文書名・ページ番号を表示
  - クリックで文書詳細へ遷移

- **質問入力欄**
  - タイプ: テキストエリア（複数行対応）
  - プレースホルダー: "質問を入力してください..."
  - Enterキーで送信（Shift+Enterで改行）
  - 文字数カウンター（最大2000文字）
  - エージェント未選択時は無効化

- **送信ボタン**
  - タイプ: プライマリボタン
  - アイコン: 送信アイコン
  - ローディング状態表示
  - エージェント未選択時は無効化

- **設定ボタン**
  - エージェント設定の上書き（オプション）
  - AIモデル選択（エージェント設定を上書き）
  - 温度パラメータ調整（エージェント設定を上書き）
  - 検索結果数の調整（エージェント設定を上書き）

### 動作フロー
1. 画面読み込み時、`/api/agent/list`でエージェント一覧を取得
2. デフォルトエージェントを選択（または最初のエージェント）
3. ユーザーがエージェントを選択（変更可能）
4. ユーザーが質問を入力
5. 「送信」ボタンをクリック（またはEnter）
6. 質問をメッセージエリアに表示
7. `/api/chat/query`にPOSTリクエスト（`agent_id`を含める）
8. ストリーミングまたは通常レスポンスで回答を表示
9. Citationsを表示
10. チャット履歴に追加（エージェントごとに分離）

### レスポンシブ対応
- モバイル: サイドバーはドロワー形式、チャットエリア全幅
- タブレット以上: サイドバー固定表示

---

## 3. エージェント管理画面（/agents）

### 画面概要
AIエージェントの作成・編集・削除・管理を行う画面です。

### URL
`/agents`

### 認証
必須

### レイアウト
- 上部: エージェント作成ボタン
- メイン: エージェント一覧（カード形式またはテーブル形式）

### UI要素

#### エージェント作成ボタン
- **新規エージェント作成ボタン**
  - タイプ: プライマリボタン
  - ラベル: "エージェントを作成"
  - クリックでエージェント作成モーダルを開く

#### エージェント一覧
- **エージェントカード/行**
  - エージェント名（大きなフォント）
  - 説明（短縮表示、ホバーで全文表示）
  - 使用モデル名
  - 文書数（"15件の文書"）
  - ステータスバッジ（アクティブ/非アクティブ）
  - 作成日時
  - アクションボタン:
    - 編集ボタン
    - 削除ボタン（確認ダイアログ）
    - チャット開始ボタン（`/chat?agent_id={id}`へ遷移）

#### エージェント作成/編集モーダル
- **エージェント名入力欄**
  - タイプ: テキスト入力
  - プレースホルダー: "エージェント名を入力"
  - バリデーション: 必須、最大255文字

- **説明入力欄**
  - タイプ: テキストエリア
  - プレースホルダー: "エージェントの説明を入力（オプション）"

- **モデル選択ドロップダウン**
  - オプション: gpt-4.1, o1-mini, gpt-4o
  - デフォルト: gpt-4.1

- **温度パラメータスライダー**
  - 範囲: 0.0 - 2.0
  - デフォルト: 0.7
  - 現在の値を数値表示

- **最大結果数入力欄**
  - タイプ: 数値入力
  - 範囲: 1 - 20
  - デフォルト: 5

- **システムプロンプト入力欄**
  - タイプ: テキストエリア
  - プレースホルダー: "システムプロンプトを入力（オプション）"
  - ヘルプテキスト: "AIの動作をカスタマイズする指示を入力"

- **アクティブフラグチェックボックス**
  - デフォルト: チェック済み

- **保存ボタン**
  - タイプ: プライマリボタン
  - ラベル: "保存"

- **キャンセルボタン**
  - タイプ: セカンダリボタン
  - ラベル: "キャンセル"

#### エージェント詳細表示（編集モーダル内）
- **文書一覧セクション**
  - エージェントに紐づく文書の一覧
  - 文書名、ファイルタイプ、追加日時を表示
  - 「文書を追加」ボタン
  - 各文書に削除ボタン

- **文書追加ダイアログ**
  - 組織内の文書一覧を表示（チェックボックス）
  - 検索・フィルタ機能
  - 「追加」ボタンで選択した文書をエージェントに追加

### 動作フロー

#### エージェント作成
1. 「エージェントを作成」ボタンをクリック
2. エージェント作成モーダルを表示
3. ユーザーが情報を入力
4. 「保存」ボタンをクリック
5. `/api/agent/create`にPOSTリクエスト
6. 成功時: エージェント一覧を更新、モーダルを閉じる

#### エージェント編集
1. エージェントカードの「編集」ボタンをクリック
2. `/api/agent/{id}`でエージェント情報を取得
3. 編集モーダルに情報を表示
4. ユーザーが情報を編集
5. 「保存」ボタンをクリック
6. `/api/agent/{id}`にPUTリクエスト
7. 成功時: エージェント一覧を更新、モーダルを閉じる

#### エージェント削除
1. エージェントカードの「削除」ボタンをクリック
2. 確認ダイアログを表示
3. ユーザーが確認
4. `/api/agent/{id}`にDELETEリクエスト
5. 成功時: エージェント一覧から削除

#### 文書追加
1. エージェント詳細の「文書を追加」ボタンをクリック
2. 文書追加ダイアログを表示
3. `/api/document/list`で文書一覧を取得
4. ユーザーが文書を選択（複数選択可能）
5. 「追加」ボタンをクリック
6. `/api/agent/{id}/documents`にPOSTリクエスト
7. 成功時: エージェント詳細の文書一覧を更新

### レスポンシブ対応
- モバイル: カード形式、1カラム
- タブレット: カード形式、2カラム
- デスクトップ: テーブル形式またはカード形式、3カラム

---

## 4. 文書アップロード画面（/upload）

### 画面概要
文書をアップロードする画面です。

### URL
`/upload`

### 認証
必須

### レイアウト
- 中央配置のアップロードエリア
- アップロード済み文書の一覧表示

### UI要素

#### アップロードエリア
- **ドラッグ&ドロップエリア**
  - ファイルをドラッグ&ドロップでアップロード
  - または「ファイルを選択」ボタンでファイル選択
  - 複数ファイル対応
  - 対応形式の表示（PDF, DOCX, XLSX, PPTX, 画像）

- **ファイル選択ボタン**
  - タイプ: セカンダリボタン
  - ラベル: "ファイルを選択"
  - ファイル選択ダイアログを開く

- **アップロードボタン**
  - タイプ: プライマリボタン
  - ラベル: "アップロード"
  - 選択ファイルがある場合のみ有効

- **ファイルリスト**
  - 選択したファイルの一覧表示
  - ファイル名、サイズ、タイプを表示
  - 削除ボタン（個別削除）

#### アップロード進捗表示
- プログレスバー
- アップロード中のファイル名
- 処理ステータス（アップロード中/解析中/完了/エラー）

#### Microsoft365同期セクション
- **同期ボタン**
  - タイプ: セカンダリボタン
  - ラベル: "Microsoft365から同期"
  - クリックで同期ダイアログを開く

- **同期設定ダイアログ**
  - フォルダパス入力
  - 再帰的同期のチェックボックス
  - 同期開始ボタン

#### ローカルフォルダ取り込みセクション
- **取り込みボタン**
  - タイプ: セカンダリボタン
  - ラベル: "ローカルフォルダから取り込み"
  - クリックで取り込みダイアログを開く

- **取り込み設定ダイアログ**
  - フォルダパス入力（システム内の絶対パス）
  - 再帰的取り込みのチェックボックス
  - ファイルパターン入力（オプション、例: "*.pdf,*.docx"）
  - 取り込み開始ボタン

### 動作フロー

#### ファイルアップロード
1. ユーザーがファイルを選択（ドラッグ&ドロップまたはファイル選択）
2. ファイル形式・サイズをバリデーション
3. 「アップロード」ボタンをクリック
4. `/api/document/upload`にPOSTリクエスト（multipart/form-data）
5. 進捗を表示
6. 完了後、`/documents`にリダイレクトまたは通知

#### ローカルフォルダ取り込み
1. 「ローカルフォルダから取り込み」ボタンをクリック
2. 取り込み設定ダイアログを表示
3. ユーザーがフォルダパス、再帰的取り込み、ファイルパターンを設定
4. 「取り込み開始」ボタンをクリック
5. `/api/document/local-folder/import`にPOSTリクエスト
6. 取り込み開始を通知
7. バックグラウンドで処理が進行
8. 完了後、`/documents`にリダイレクトまたは通知

### バリデーション
- ファイル形式: PDF, DOCX, XLSX, PPTX, JPG, PNG, GIF
- ファイルサイズ: 最大100MB
- ファイル数: 最大10ファイル同時アップロード

### レスポンシブ対応
- モバイル: ドラッグ&ドロップエリアを全幅、ファイルリストを縦並び
- タブレット以上: 中央配置、2カラムレイアウト

---

## 5. 文書一覧画面（/documents）

### 画面概要
アップロード済み文書の一覧とステータスを表示する画面です。

### URL
`/documents`

### 認証
必須

### レイアウト
- 上部: 検索・フィルタバー
- メイン: 文書一覧（テーブルまたはカード形式）

### UI要素

#### 検索・フィルタバー
- **検索入力欄**
  - タイプ: テキスト入力
  - プレースホルダー: "ファイル名で検索..."
  - リアルタイム検索

- **ステータスフィルタ**
  - ドロップダウン
  - オプション: すべて/処理中/完了/エラー

- **ファイルタイプフィルタ**
  - ドロップダウン
  - オプション: すべて/PDF/Office/画像

- **ソート選択**
  - ドロップダウン
  - オプション: 新着順/古い順/ファイル名順/サイズ順

#### 文書一覧
- **テーブル形式（デスクトップ）**
  - 列: ファイル名、タイプ、サイズ、ステータス、作成日時、アクション
  - 行をクリックで詳細表示
  - ページネーション

- **カード形式（モバイル）**
  - カード: ファイル名、タイプ、ステータス、作成日時
  - カードをタップで詳細表示

#### 文書カード/行の要素
- **ファイル名**
  - クリックで詳細表示
  - 長い場合は省略表示

- **ファイルタイプアイコン**
  - PDF/Office/画像のアイコン表示

- **ステータスバッジ**
  - 処理中: 黄色
  - 完了: 緑色
  - エラー: 赤色

- **アクションボタン**
  - 削除ボタン（確認ダイアログ表示）
  - 詳細ボタン

#### ページネーション
- 前へ/次へボタン
- ページ番号表示
- 1ページあたりの件数選択（20/50/100）

### 動作フロー
1. 画面読み込み時、`/api/document/list`にGETリクエスト
2. 文書一覧を表示
3. 検索・フィルタ変更時、再検索
4. 文書クリック時、詳細モーダルまたは詳細画面へ遷移
5. 削除ボタンクリック時、確認ダイアログ表示
6. 確認後、`/api/document/{id}`にDELETEリクエスト

### レスポンシブ対応
- モバイル: カード形式、1カラム
- タブレット: カード形式、2カラム
- デスクトップ: テーブル形式

---

## 6. 文書詳細画面（/documents/{id}）

### 画面概要
文書の詳細情報とチャンク一覧を表示する画面です。

### URL
`/documents/{id}`

### 認証
必須

### レイアウト
- 上部: 文書情報セクション
- 下部: チャンク一覧セクション

### UI要素

#### 文書情報セクション
- **ファイル名**
  - 大きなフォントで表示

- **メタ情報**
  - ファイルタイプ、サイズ、作成日時
  - ステータスバッジ
  - チャンク数

- **アクションボタン**
  - ダウンロードボタン（元ファイル）
  - 削除ボタン
  - 再処理ボタン（エラー時）

#### チャンク一覧セクション
- **チャンクカード**
  - チャンクテキスト（最初の200文字）
  - チャンクインデックス
  - ページ番号（該当する場合）
  - チャンクタイプ（テキスト/表/画像等）

- **検索機能**
  - チャンク内テキスト検索

- **ページネーション**
  - チャンクが多い場合

### 動作フロー
1. 画面読み込み時、`/api/document/{id}`にGETリクエスト
2. 文書情報を表示
3. チャンク情報を取得して表示
4. 削除ボタンクリック時、確認ダイアログ表示
5. 確認後、削除APIを呼び出し、`/documents`にリダイレクト

### レスポンシブ対応
- モバイル: 縦並びレイアウト
- タブレット以上: 2カラムレイアウト

---

## 7. 設定画面（/settings）

### 画面概要
ユーザー設定と組織設定を管理する画面です。

### URL
`/settings`

### 認証
必須

### レイアウト
- タブ形式: ユーザー設定 / 組織設定 / Microsoft365設定

### UI要素

#### ユーザー設定タブ
- **パスワード変更**
  - 現在のパスワード入力
  - 新しいパスワード入力
  - 確認用パスワード入力
  - 変更ボタン

#### 組織設定タブ
- **組織情報表示**
  - 組織名（読み取り専用）
  - 作成日時
  - 文書数、ユーザー数

#### Microsoft365設定タブ
- **接続状態表示**
  - 接続済み/未接続のバッジ
  - 最終同期日時

- **接続ボタン**
  - Microsoft365認証フローを開始

- **同期設定**
  - 同期フォルダパス
  - 自動同期の有効/無効
  - 同期頻度設定

### 動作フロー
1. 各タブで設定を変更
2. 保存ボタンクリック時、対応APIにリクエスト
3. 成功時、成功メッセージを表示

---

## 共通コンポーネント

### ヘッダー
- ロゴ（クリックで`/chat`へ）
- ナビゲーションメニュー
- ユーザー情報（ドロップダウン）
  - ユーザー名表示
  - ログアウトボタン

### サイドバー
- メニュー項目
  - チャット（`/chat`）
  - エージェント管理（`/agents`）
  - 文書アップロード（`/upload`）
  - 文書一覧（`/documents`）
  - 設定（`/settings`）

### ローディング表示
- スピナーアニメーション
- ローディングメッセージ

### エラー表示
- アラート形式
- エラーメッセージ
- 閉じるボタン

### モーダル
- 確認ダイアログ
- 詳細表示モーダル

---

## アクセシビリティ

### 対応項目
- キーボードナビゲーション
- スクリーンリーダー対応（ARIA属性）
- コントラスト比の確保（WCAG 2.1 AA準拠）
- フォーカス表示の明確化

---

## パフォーマンス

### 最適化
- 画像の遅延読み込み
- 無限スクロールまたはページネーション
- APIレスポンスのキャッシュ
- コード分割（Next.jsの動的インポート）

---

## 変更履歴

| 日付 | 変更内容 | 変更理由 |
|------|---------|---------|
| 2024-XX-XX | 初版作成 | プロジェクト開始 |
| 2024-XX-XX | エージェント管理画面追加、チャット画面にエージェント選択機能追加、ローカルフォルダ取り込み機能追加 | AIエージェント機能とローカルフォルダ対応の追加 |

